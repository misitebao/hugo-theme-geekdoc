const DARK_MODE = "dark";
const LIGHT_MODE = "light";
const THEME = "gdoc-dark";

(applyTheme = function (init = true) {
  let html = document.documentElement;
  let currentMode = localStorage.getItem(THEME);

  let darkModeQuery = window.matchMedia("(prefers-color-scheme: dark)");
  if (!currentMode && darkModeQuery.matches) {
    localStorage.setItem(THEME, DARK_MODE);
    currentMode = DARK_MODE;
  }

  if (currentMode === DARK_MODE) {
    html.classList.add(DARK_MODE);
  } else {
    html.classList.remove(DARK_MODE);
  }

  if (!init) {
    // Reload required to re-initialise e.g. Mermaid with the new theme and re-parse the Mermaid code blocks.
    location.reload();
  }
})();

document.addEventListener("DOMContentLoaded", (event) => {
  const darkModeToggle = document.getElementById("gdoc-dark-mode");

  darkModeToggle.onclick = function () {
    let currentMode = localStorage.getItem(THEME);
    localStorage.setItem(
      THEME,
      currentMode === DARK_MODE ? LIGHT_MODE : DARK_MODE
    );
    applyTheme(false);
  };
});
